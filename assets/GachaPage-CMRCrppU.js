import{R as e,j as t,B as i,V as n,h as o,i as a,d as r,r as s,P as l,H as c,z as d,E as p,u as x,x as g}from"./chakra-ui-DWnHQl4o.js";import{s as h,a as m}from"./index-C5BTWW3Y.js";import{m as u,A as f}from"./framer-motion-D_CV7aB0.js";import{c as b}from"./confetti-BSjof-hN.js";import{b as y,u as j}from"./router-1Oqxu31X.js";const S=u(i),v=u(o),w=({items:o})=>{const a=e.useMemo(()=>{const e=[];for(let t=0;t<10;t++)e.push(...h(o));return e.slice(0,20)},[o]);return t.jsxs(i,{position:"relative",w:"full",h:"400px",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",bg:"linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 100%)",borderRadius:"xl",boxShadow:"xl",children:[t.jsx(S,{position:"absolute",top:0,left:0,right:0,bottom:0,bg:"radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%)",animate:{scale:[1,1.2,1],rotate:[0,180,360]},transition:{duration:3,repeat:1/0,ease:"linear"}}),t.jsxs(i,{position:"relative",w:"300px",h:"200px",bg:"white",borderRadius:"lg",border:"4px solid white",boxShadow:"inset 0 0 20px rgba(0,0,0,0.1)",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",children:[t.jsx(n,{gap:2,position:"absolute",w:"full",children:a.slice(0,5).map((e,i)=>t.jsx(v,{fontSize:"lg",fontWeight:"bold",color:"#2D3748",textAlign:"center",px:4,py:2,w:"full",initial:{y:-100,opacity:0},animate:{y:[0,100],opacity:[1,0]},transition:{duration:.6,delay:.1*i,repeat:1/0,repeatDelay:2},children:e.text},`${e.id}-${i}`))}),t.jsx(i,{position:"absolute",top:"45%",left:0,right:0,h:"2px",bg:"#FF6B6B",zIndex:2}),t.jsx(i,{position:"absolute",top:"55%",left:0,right:0,h:"2px",bg:"#FF6B6B",zIndex:2})]}),t.jsx(v,{position:"absolute",bottom:"20px",fontSize:"sm",color:"white",fontWeight:"medium",animate:{opacity:[.7,1,.7]},transition:{duration:1,repeat:1/0},children:"뽑는 중..."})]})},F=u(r),z=u(i),R=({onStart:e,gameStats:i,itemCount:r})=>t.jsxs(n,{spacing:6,children:[t.jsx(z,{initial:{scale:0},animate:{scale:1},transition:{delay:.3,type:"spring"},children:t.jsxs(a,{colorScheme:"purple",fontSize:"lg",px:4,py:2,borderRadius:"full",textAlign:"center",children:["🏆 레벨 ",i.level," (XP: ",i.xp,")"]})}),t.jsxs(n,{spacing:2,children:[t.jsx(o,{fontSize:"xl",fontWeight:"bold",color:"#FF6B6B",textAlign:"center",children:"🎯 가챠 준비 완료!"}),t.jsxs(o,{fontSize:"md",color:"gray.600",textAlign:"center",children:[r,"개의 항목에서 하나를 뽑아보세요"]}),t.jsx(o,{fontSize:"sm",color:"gray.500",textAlign:"center",children:"💡 타이밍을 맞춰서 더 많은 XP를 획득하세요!"})]}),t.jsx(F,{size:"xl",colorScheme:"red",onClick:e,px:12,py:8,fontSize:"2xl",fontWeight:"bold",borderRadius:"full",boxShadow:"0 8px 25px rgba(255, 107, 107, 0.4)",_hover:{transform:"translateY(-3px)",boxShadow:"0 12px 30px rgba(255, 107, 107, 0.5)"},_active:{transform:"translateY(-1px)"},initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{delay:.6,type:"spring",stiffness:260,damping:20},whileHover:{scale:1.05},whileTap:{scale:.95},children:"🎲 뽑기 시작!"}),t.jsx(z,{position:"absolute",w:"200px",h:"80px",borderRadius:"full",border:"3px solid #FF6B6B",opacity:.3,zIndex:-1,animate:{scale:[1,1.3,1],opacity:[.3,0,.3]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),t.jsxs(n,{spacing:1,pt:4,children:[t.jsxs(o,{fontSize:"xs",color:"gray.500",children:["총 가챠: ",i.totalGachas,"회 | 완벽 타이밍: ",i.perfectTimings,"회"]}),i.achievements.length>0&&t.jsxs(o,{fontSize:"xs",color:"purple.500",children:["🏅 달성 업적: ",i.achievements.length,"개"]})]})]}),A=u(r),D=u(i),C=({timingGame:e,onStop:r,animationDuration:c})=>{const[d,p]=s.useState(0),[x,g]=s.useState(c);s.useEffect(()=>{if(!e.isActive)return;const t=Date.now(),i=setInterval(()=>{const e=Date.now()-t,n=e/c*100,o=Math.max(0,c-e);p(Math.min(100,n)),g(o),e>=c&&(clearInterval(i),r("miss"))},16);return()=>clearInterval(i)},[e.isActive,c,r]);return e.isActive?t.jsxs(n,{spacing:4,w:"full",maxW:"400px",children:[t.jsxs(i,{w:"full",position:"relative",children:[t.jsx(l,{value:d,size:"lg",colorScheme:d>=50&&d<=83?"green":"red",bg:"gray.200",borderRadius:"full",height:"20px"}),t.jsx(i,{position:"absolute",top:"0",left:"50%",width:"33%",height:"20px",bg:"green.200",borderRadius:"full",border:"2px solid",borderColor:"green.400",opacity:.7}),t.jsx(D,{position:"absolute",top:"-5px",left:`${d}%`,transform:"translateX(-50%)",w:"10px",h:"30px",bg:(()=>{const t=e.targetZoneStart/c*100,i=e.targetZoneEnd/c*100;return d>=t&&d<=i?"green.400":"yellow.400"})(),borderRadius:"full",border:"2px solid white",boxShadow:"0 2px 8px rgba(0,0,0,0.3)",animate:{scale:[1,1.2,1]},transition:{duration:.5,repeat:1/0}})]}),t.jsxs(n,{spacing:2,children:[t.jsx(a,{colorScheme:d>=50&&d<=83?"green":"red",fontSize:"md",px:3,py:1,borderRadius:"full",children:d>=50&&d<=83?"🎯 완벽 존!":"⚡ 타이밍을 노려보세요!"}),t.jsxs(o,{fontSize:"sm",color:"gray.600",children:["남은 시간: ",(x/1e3).toFixed(1),"초"]})]}),t.jsx(A,{size:"xl",colorScheme:d>=50&&d<=83?"green":"orange",onClick:()=>{const t=Date.now()-e.startTime;let i;i=t>=e.targetZoneStart&&t<=e.targetZoneEnd?"perfect":t>=e.targetZoneStart-500&&t<e.targetZoneStart||t>e.targetZoneEnd&&t<=e.targetZoneEnd+500?"good":"miss",r(i)},px:10,py:6,fontSize:"xl",fontWeight:"bold",borderRadius:"full",boxShadow:"0 6px 20px rgba(0,0,0,0.2)",_hover:{transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(0,0,0,0.3)"},_active:{transform:"translateY(0)"},animate:{scale:d>=50&&d<=83?[1,1.1,1]:1,boxShadow:d>=50&&d<=83?["0 6px 20px rgba(0,0,0,0.2)","0 8px 30px rgba(34, 197, 94, 0.4)","0 6px 20px rgba(0,0,0,0.2)"]:"0 6px 20px rgba(0,0,0,0.2)"},transition:{duration:.3,repeat:d>=50&&d<=83?1/0:0},whileHover:{scale:1.05},whileTap:{scale:.95},children:"⏹️ 스톱!"}),t.jsx(o,{fontSize:"xs",color:"gray.500",textAlign:"center",children:"녹색 영역에서 멈추면 완벽한 타이밍! +15 XP 획득"})]}):null},T=u(i),B=u(o),E=({item:e,showResult:r,timingAccuracy:l,xpGained:c})=>(s.useEffect(()=>{if(r){let e=["#FF6B6B","#4ECDC4","#FFE66D","#95E1D3","#F38BA8"],t=50,i=3e3;"perfect"===l?(e=["#FFD700","#FFA500","#FF69B4","#9370DB","#00CED1"],t=100,i=5e3):"good"===l&&(e=["#32CD32","#00FF7F","#ADFF2F","#98FB98"],t=75,i=4e3);const n=Date.now()+i,o=setInterval(()=>{Date.now()>n?clearInterval(o):(b({particleCount:t,angle:60,spread:55,origin:{x:0,y:.8},colors:e}),b({particleCount:t,angle:120,spread:55,origin:{x:1,y:.8},colors:e}))},"perfect"===l?50:100);return setTimeout(()=>{b({particleCount:"perfect"===l?200:2*t,angle:90,spread:80,origin:{x:.5,y:.6},colors:e})},500),()=>clearInterval(o)}},[r,l]),r?t.jsxs(i,{position:"relative",w:"full",display:"flex",justifyContent:"center",children:[t.jsx(i,{position:"absolute",top:"-50px",left:"-50px",w:"400px",h:"400px",bg:"radial-gradient(circle, rgba(255, 230, 109, 0.3) 0%, transparent 70%)",borderRadius:"full",pointerEvents:"none",as:T,animate:{scale:[1,1.5,1],opacity:[.6,0,.6]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),t.jsx(T,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:260,damping:20,duration:.8},position:"relative",zIndex:2,children:t.jsxs(n,{gap:6,children:[t.jsx(B,{fontSize:"4xl",animate:{scale:[1,1.2,1],rotate:[0,10,-10,0]},transition:{duration:.6,repeat:1/0,repeatDelay:2},children:"🎉"}),l&&t.jsxs(a,{colorScheme:"perfect"===l?"yellow":"good"===l?"green":"gray",variant:"solid",px:4,py:2,fontSize:"md",borderRadius:"full",boxShadow:"0 4px 12px rgba(255, 230, 109, 0.4)",children:["perfect"===l&&"🏆 완벽한 타이밍!","good"===l&&"👍 좋은 타이밍!","miss"===l&&"😅 아쉬운 타이밍"]}),t.jsx(a,{colorScheme:"purple",variant:"solid",px:4,py:2,fontSize:"md",borderRadius:"full",boxShadow:"0 4px 12px rgba(128, 90, 213, 0.4)",children:"🎯 결과"}),t.jsxs(T,{bg:"white",p:8,borderRadius:"2xl",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.1)",border:"4px solid #FFE66D",position:"relative",whileHover:{scale:1.05},children:[t.jsx(i,{position:"absolute",top:0,left:0,right:0,bottom:0,bg:"linear-gradient(135deg, rgba(255, 107, 107, 0.05) 0%, rgba(78, 205, 196, 0.05) 100%)",borderRadius:"xl"}),t.jsx(B,{fontSize:{base:"xl",md:"2xl"},fontWeight:"bold",color:"#2D3748",textAlign:"center",position:"relative",zIndex:1,children:e.text}),t.jsx(i,{position:"absolute",top:"-10px",right:"-10px",w:"30px",h:"30px",bg:"#FFE66D",borderRadius:"full",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 8px rgba(255, 230, 109, 0.3)",children:t.jsx(o,{fontSize:"lg",children:"✨"})})]}),c&&t.jsxs(B,{fontSize:"lg",fontWeight:"bold",color:"perfect"===l?"#FFD700":"#4ECDC4",textAlign:"center",initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{delay:.3,type:"spring"},children:["+",c," XP 획득! 💎"]}),t.jsx(B,{fontSize:"lg",fontWeight:"medium",color:"#4ECDC4",textAlign:"center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:"선택되었습니다! 🎊"})]})})]}):null),I=({onRetry:e,onGoHome:i})=>t.jsxs(c,{gap:6,mt:8,children:[t.jsx(r,{size:"lg",colorScheme:"orange",leftIcon:t.jsx(d,{}),onClick:e,px:8,py:6,borderRadius:"full",children:"다시 뽑기"}),t.jsx(r,{size:"lg",colorScheme:"teal",variant:"outline",leftIcon:t.jsx(p,{}),onClick:i,px:8,py:6,borderRadius:"full",borderWidth:"2px",children:"처음으로"})]}),G=u(i),W=u(o),Z=({newAchievements:e,leveledUp:i,newLevel:r,onComplete:l})=>{const c=x();return s.useEffect(()=>{if(e.length>0||i){b({particleCount:i?150:100,angle:90,spread:80,origin:{x:.5,y:.4},colors:i?["#FFD700","#FFA500","#FF69B4","#9370DB"]:["#FF6B6B","#4ECDC4","#FFE66D","#95E1D3"]}),i&&r&&c({title:"🎉 레벨업!",description:`레벨 ${r} 달성! 새로운 테마가 해제되었습니다.`,status:"success",duration:4e3,isClosable:!0}),e.forEach(e=>{c({title:`🏆 업적 달성: ${e.name}`,description:`${e.description} (+${e.xpReward} XP)`,status:"success",duration:5e3,isClosable:!0})});const t=setTimeout(l,3e3);return()=>clearTimeout(t)}},[e,i,r,c,l]),0!==e.length||i?t.jsx(f,{children:t.jsxs(G,{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1e3,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},transition:{type:"spring",stiffness:300,damping:30},children:[t.jsxs(n,{spacing:4,bg:"white",p:8,borderRadius:"2xl",boxShadow:"0 20px 40px rgba(0,0,0,0.3)",border:"3px solid #FFD700",textAlign:"center",minW:"300px",children:[i&&r&&t.jsx(G,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},children:t.jsxs(n,{spacing:2,children:[t.jsx(W,{fontSize:"3xl",animate:{scale:[1,1.2,1],rotate:[0,5,-5,0]},transition:{duration:.6,repeat:2},children:"🎊"}),t.jsxs(a,{colorScheme:"yellow",fontSize:"xl",px:6,py:2,borderRadius:"full",textTransform:"none",children:["레벨 ",r," 달성!"]}),t.jsx(o,{fontSize:"sm",color:"gray.600",children:"새로운 테마와 효과가 해제되었습니다!"})]})}),e.map((e,r)=>t.jsx(G,{initial:{x:-50,opacity:0},animate:{x:0,opacity:1},transition:{delay:i?.5+.2*r:.2*r},children:t.jsxs(n,{spacing:2,p:4,bg:"purple.50",borderRadius:"lg",border:"2px solid",borderColor:"purple.200",children:[t.jsx(o,{fontSize:"2xl",children:e.icon}),t.jsx(o,{fontSize:"lg",fontWeight:"bold",color:"purple.700",children:e.name}),t.jsx(o,{fontSize:"sm",color:"gray.600",children:e.description}),t.jsxs(a,{colorScheme:"purple",borderRadius:"full",children:["+",e.xpReward," XP"]})]})},e.id)),t.jsx(W,{fontSize:"xs",color:"gray.500",initial:{opacity:0},animate:{opacity:1},transition:{delay:2},children:"3초 후 자동으로 닫힙니다..."})]}),t.jsx(G,{position:"absolute",top:"-10px",left:"-10px",right:"-10px",bottom:"-10px",borderRadius:"3xl",bg:"linear-gradient(45deg, #FFD700, #FFA500, #FFD700, #FFA500)",opacity:.3,zIndex:-1,animate:{rotate:360},transition:{duration:3,repeat:1/0,ease:"linear"}})]})}):null},k="doldol-game-stats",_={level:1,xp:0,totalGachas:0,perfectTimings:0,achievements:[],unlockedThemes:["default"]},H=[{id:"first_gacha",name:"첫 뽑기",description:"첫 번째 가챠를 완료했습니다",icon:"🎯",condition:e=>e.totalGachas>=1,xpReward:10},{id:"perfect_timing",name:"완벽한 타이밍",description:"완벽한 타이밍으로 가챠를 멈췄습니다",icon:"⏰",condition:e=>e.perfectTimings>=1,xpReward:20},{id:"gacha_master",name:"가챠 마스터",description:"10번의 가챠를 완료했습니다",icon:"🏆",condition:e=>e.totalGachas>=10,xpReward:50},{id:"timing_expert",name:"타이밍 전문가",description:"5번의 완벽한 타이밍을 달성했습니다",icon:"🎖️",condition:e=>e.perfectTimings>=5,xpReward:100},{id:"veteran",name:"베테랑",description:"50번의 가챠를 완료했습니다",icon:"👑",condition:e=>e.totalGachas>=50,xpReward:200}],P=e=>Math.floor(e/100)+1,X=()=>{try{const t=localStorage.getItem(k);if(!t)return{..._};const i=JSON.parse(t);return(e=i)&&"object"==typeof e&&"number"==typeof e.level&&"number"==typeof e.xp&&"number"==typeof e.totalGachas&&"number"==typeof e.perfectTimings&&Array.isArray(e.achievements)&&Array.isArray(e.unlockedThemes)&&e.level>=1&&e.level<=1e3&&e.xp>=0&&e.totalGachas>=0&&e.perfectTimings>=0?i:(localStorage.removeItem(k),{..._})}catch(t){return localStorage.removeItem(k),{..._}}var e},$=(e,t)=>{let i=10;"perfect"===t?i+=15:"good"===t&&(i+=5);return((e,t)=>{const i=e.level,n=e.xp+t,o=P(n),a={...e,xp:n,level:o},r=H.filter(t=>!e.achievements.includes(t.id)&&t.condition(a));if(r.length>0){const t=r.reduce((e,t)=>e+t.xpReward,0);a.xp+=t,a.level=P(a.xp),a.achievements=[...e.achievements,...r.map(e=>e.id)],r.some(e=>"timing_expert"===e.id)&&(a.unlockedThemes=[...a.unlockedThemes,"golden"]),r.some(e=>"veteran"===e.id)&&(a.unlockedThemes=[...a.unlockedThemes,"rainbow"])}return{newStats:a,leveledUp:o>i,newAchievements:r}})({...e,totalGachas:e.totalGachas+1,perfectTimings:"perfect"===t?e.perfectTimings+1:e.perfectTimings},i)},M=()=>{const e=y(),a=j(),[r,l]=s.useState("ready"),[c,d]=s.useState(null),[p,x]=s.useState(!1),[h,u]=s.useState("miss"),[f,b]=s.useState(0),[S,v]=s.useState({isActive:!1,startTime:0,targetZoneStart:1500,targetZoneEnd:2500}),[F,z]=s.useState(X()),[A,D]=s.useState([]),[T,B]=s.useState(!1),[G,W]=s.useState(),_=e.state,H=_?.items||[];s.useEffect(()=>{H.length<2&&a("/")},[H.length,a]);return H.length<2?null:t.jsxs(i,{bg:"#F7F7F7",minH:"100vh",py:8,position:"relative",children:[t.jsx(g,{maxW:"4xl",h:"90vh",children:t.jsxs(n,{spacing:8,align:"center",justify:"center",h:"full",children:["ready"===r&&t.jsx(R,{onStart:()=>{l("animating"),x(!1),d(null);const e=Date.now();v({isActive:!0,startTime:e,targetZoneStart:1500,targetZoneEnd:2500}),setTimeout(()=>{l("timing")},500)},gameStats:F,itemCount:H.length}),"animating"===r&&t.jsxs(t.Fragment,{children:[t.jsx(o,{fontSize:"2xl",fontWeight:"bold",color:"#FF6B6B",textAlign:"center",children:"🎯 가챠 애니메이션 시작!"}),t.jsx(w,{items:H})]}),"timing"===r&&t.jsxs(t.Fragment,{children:[t.jsx(o,{fontSize:"xl",fontWeight:"bold",color:"#FF6B6B",textAlign:"center",children:"⚡ 지금이야! 타이밍을 맞춰보세요!"}),t.jsx(w,{items:H}),t.jsx(C,{timingGame:S,onStop:e=>{u(e),v(e=>({...e,isActive:!1})),l("result");const t=m(H);d(t);const{newStats:i,leveledUp:n,newAchievements:o}=$(F,e);z(i),(e=>{try{localStorage.setItem(k,JSON.stringify(e))}catch(t){}})(i);let a=10;"perfect"===e?a+=15:"good"===e&&(a+=5),b(a),D(o),B(n),W(n?i.level:void 0),setTimeout(()=>{x(!0)},1e3)},animationDuration:3e3})]}),"result"===r&&t.jsxs(t.Fragment,{children:[c&&t.jsx(E,{item:c,showResult:p,timingAccuracy:h,xpGained:f}),p&&t.jsx(I,{onRetry:()=>{l("ready"),x(!1),d(null),u("miss"),b(0),D([]),B(!1),W(void 0)},onGoHome:()=>{a("/")}})]})]})}),t.jsx(Z,{newAchievements:A,leveledUp:T,newLevel:G,onComplete:()=>{D([]),B(!1),W(void 0)}})]})};export{M as default};
